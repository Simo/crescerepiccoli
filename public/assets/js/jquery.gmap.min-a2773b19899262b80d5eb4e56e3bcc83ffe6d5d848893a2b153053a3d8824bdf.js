!function(e){var t=google.maps,i=new t.Geocoder,n=0,s={},s={init:function(i){var n,o=e.extend({},e.fn.gMap.defaults,i);for(n in e.fn.gMap.defaults.icon)o.icon[n]||(o.icon[n]=e.fn.gMap.defaults.icon[n]);return this.each(function(){var i=e(this),n=s._getMapCenter.apply(i,[o]);"fit"==o.zoom&&(o.zoom=s.autoZoom.apply(i,[o]));var r=new t.Map(this,{zoom:o.zoom,center:n,mapTypeControl:o.mapTypeControl,zoomControl:o.zoomControl,panControl:o.panControl,scaleControl:o.scaleControl,streetViewControl:o.streetViewControl,mapTypeId:o.maptype,scrollwheel:o.scrollwheel,maxZoom:o.maxZoom,minZoom:o.minZoom});if(o.log&&console.log("map center is:"),o.log&&console.log(n),i.data("$gmap",r),i.data("gmap",{opts:o,gmap:r,markers:[],markerKeys:{},infoWindow:null}),0!==o.controls.length)for(n=0;n<o.controls.length;n+=1)r.controls[o.controls[n].pos].push(o.controls[n].div);0!==o.markers.length&&s.addMarkers.apply(i,[o.markers]),s._onComplete.apply(i,[])})},_onComplete:function(){var e=this.data("gmap"),t=this;0!==n?window.setTimeout(function(){s._onComplete.apply(t,[])},1e3):e.opts.onComplete()},_setMapCenter:function(e){var t=this.data("gmap");if(t.opts.log&&console.log("delayed setMapCenter called"),void 0!==t.gmap)t.gmap.setCenter(e);else{var i=this;window.setTimeout(function(){s._setMapCenter.apply(i,[e])},500)}},_boundaries:null,_getBoundaries:function(e){if(s._boundaries)return s._boundaries;var t,i=e.markers[0].latitude,n=e.markers[0].longitude,o=e.markers[0].longitude,r=e.markers[0].latitude;for(t=1;t<e.markers.length;t+=1)i>e.markers[t].latitude&&(i=e.markers[t].latitude),n<e.markers[t].longitude&&(n=e.markers[t].longitude),o>e.markers[t].longitude&&(o=e.markers[t].longitude),r<e.markers[t].latitude&&(r=e.markers[t].latitude);return s._boundaries={N:i,E:n,W:o,S:r},s._boundaries},_getMapCenter:function(e){var n,o,r,a=this;if(e.markers.length&&("fit"==e.latitude||"fit"==e.longitude))return n=s._getBoundaries(e),n=new t.LatLng((n.N+n.S)/2,(n.E+n.W)/2);if(e.latitude&&e.longitude)return n=new t.LatLng(e.latitude,e.longitude);if(n=new t.LatLng(0,0),e.address)return i.geocode({address:e.address},function(t,i){i===google.maps.GeocoderStatus.OK?s._setMapCenter.apply(a,[t[0].geometry.location]):e.log&&console.log("Geocode was not successful for the following reason: "+i)}),n;if(e.markers.length>0){for(r=null,o=0;o<e.markers.length;o+=1)if(e.markers[o].setCenter){r=e.markers[o];break}if(null===r)for(o=0;o<e.markers.length;o+=1){if(e.markers[o].latitude&&e.markers[o].longitude){r=e.markers[o];break}e.markers[o].address&&(r=e.markers[o])}if(null===r)return n;if(r.latitude&&r.longitude)return new t.LatLng(r.latitude,r.longitude);r.address&&i.geocode({address:r.address},function(t,i){i===google.maps.GeocoderStatus.OK?s._setMapCenter.apply(a,[t[0].geometry.location]):e.log&&console.log("Geocode was not successful for the following reason: "+i)})}return n},setZoom:function(t){var i=this.data("gmap").gmap;"fit"===t&&(t=s.autoZoom.apply(e(this),[])),i.setZoom(parseInt(t))},getRoute:function(i){var n=this.data("gmap"),s=n.gmap,o=new t.DirectionsRenderer,r=new t.DirectionsService,a={BYCAR:t.DirectionsTravelMode.DRIVING,BYBICYCLE:t.DirectionsTravelMode.BICYCLING,BYFOOT:t.DirectionsTravelMode.WALKING},l={MILES:t.DirectionsUnitSystem.IMPERIAL,KM:t.DirectionsUnitSystem.METRIC},c=null,u=null,d=null;return void 0!==i.routeDisplay?c=i.routeDisplay instanceof jQuery?i.routeDisplay[0]:"string"==typeof i.routeDisplay?e(i.routeDisplay)[0]:null:null!==n.opts.routeDisplay&&(c=n.opts.routeDisplay instanceof jQuery?n.opts.routeDisplay[0]:"string"==typeof n.opts.routeDisplay?e(n.opts.routeDisplay)[0]:null),o.setMap(s),null!==c&&o.setPanel(c),u=void 0!==a[n.opts.travelMode]?a[n.opts.travelMode]:a.BYCAR,d=void 0!==l[n.opts.travelUnit]?l[n.opts.travelUnit]:l.KM,r.route({origin:i.from,destination:i.to,travelMode:u,unitSystem:d},function(i,s){s==t.DirectionsStatus.OK?o.setDirections(i):null!==c&&e(c).html(n.opts.routeErrors[s])}),this},processMarker:function(e,i,n,s){var o,r=this.data("gmap"),a=r.gmap,l=r.opts;if(void 0===s&&(s=new t.LatLng(e.latitude,e.longitude)),!i)var c={image:l.icon.image,iconSize:new t.Size(l.icon.iconsize[0],l.icon.iconsize[1]),iconAnchor:new t.Point(l.icon.iconanchor[0],l.icon.iconanchor[1]),infoWindowAnchor:new t.Size(l.icon.infowindowanchor[0],l.icon.infowindowanchor[1])},i=new t.MarkerImage(c.image,c.iconSize,null,c.iconAnchor);n||(new t.Size(l.icon.shadowsize[0],l.icon.shadowsize[1]),c&&c.iconAnchor||new t.Point(l.icon.iconanchor[0],l.icon.iconanchor[1])),o=new t.Marker({position:s,icon:i,title:e.title,map:a}),o.setShadow(n),r.markers.push(o),e.key&&(r.markerKeys[e.key]=o);var u;e.html&&(i={content:"string"==typeof e.html?l.html_prepend+e.html+l.html_append:e.html,pixelOffset:e.infoWindowAnchor},l.log&&console.log("setup popup with data"),l.log&&console.log(i),u=new t.InfoWindow(i),t.event.addListener(o,"click",function(){l.log&&console.log("opening popup "+e.html),l.singleInfoWindow&&r.infoWindow&&r.infoWindow.close(),u.open(a,o),r.infoWindow=u})),e.html&&e.popup&&(l.log&&console.log("opening popup "+e.html),u.open(a,o),r.infoWindow=u)},_geocodeMarker:function(e,o,r){n+=1;var a=this;i.geocode({address:e.address},function(i,l){n-=1,l===t.GeocoderStatus.OK?(a.data("gmap").opts.log&&console.log("Geocode was successful with point: ",i[0].geometry.location),s.processMarker.apply(a,[e,o,r,i[0].geometry.location])):a.data("gmap").opts.log&&console.log("Geocode was not successful for the following reason: "+l)})},autoZoom:function(e){var t,i=this.data("gmap"),n=39135.758482,e=i?i.opts:e;for(e.log&&console.log("autozooming map"),i=s._getBoundaries(e),e=111e3*(i.E-i.W)/this.width(),t=111e3*(i.S-i.N)/this.height(),i=2;20>i&&!(e>n||t>n);i+=1)n/=2;return i-2},addMarkers:function(t){var i=this.data("gmap").opts;if(0!==t.length)for(i.log&&console.log("adding "+t.length+" markers"),i=0;i<t.length;i+=1)s.addMarker.apply(e(this),[t[i]]);return this},addMarker:function(e){var i=this.data("gmap").opts;i.log&&console.log("putting marker at "+e.latitude+", "+e.longitude+" with address "+e.address+" and html "+e.html);var n=i.icon.image,o=new t.Size(i.icon.iconsize[0],i.icon.iconsize[1]),r=new t.Point(i.icon.iconanchor[0],i.icon.iconanchor[1]),a=new t.Size(i.icon.infowindowanchor[0],i.icon.infowindowanchor[1]),l=i.icon.shadow,c=new t.Size(i.icon.shadowsize[0],i.icon.shadowsize[1]),u=r;return e.infoWindowAnchor=a,e.icon&&(e.icon.image&&(n=e.icon.image),e.icon.iconsize&&(o=new t.Size(e.icon.iconsize[0],e.icon.iconsize[1])),e.icon.iconanchor&&(r=new t.Point(e.icon.iconanchor[0],e.icon.iconanchor[1])),e.icon.infowindowanchor&&new t.Size(e.icon.infowindowanchor[0],e.icon.infowindowanchor[1]),e.icon.shadow&&(l=e.icon.shadow),e.icon.shadowsize&&(c=new t.Size(e.icon.shadowsize[0],e.icon.shadowsize[1]))),n=new t.MarkerImage(n,o,null,r),l=new t.MarkerImage(l,c,null,u),e.address?("_address"===e.html&&(e.html=e.address),"_address"==e.title&&(e.title=e.address),i.log&&console.log("geocoding marker: "+e.address),s._geocodeMarker.apply(this,[e,n,l])):("_latlng"===e.html&&(e.html=e.latitude+", "+e.longitude),"_latlng"==e.title&&(e.title=e.latitude+", "+e.longitude),i=new t.LatLng(e.latitude,e.longitude),s.processMarker.apply(this,[e,n,l,i])),this},removeAllMarkers:function(){var e,t=this.data("gmap").markers;for(e=0;e<t.length;e+=1)t[e].setMap(null),delete t[e];t.length=0},getMarker:function(e){return this.data("gmap").markerKeys[e]}};e.fn.gMap=function(t){return s[t]?s[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.gmap"):s.init.apply(this,arguments)},e.fn.gMap.defaults={log:!1,address:"",latitude:null,longitude:null,zoom:3,maxZoom:null,minZoom:null,markers:[],controls:{},scrollwheel:!0,maptype:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,zoomControl:!0,panControl:!1,scaleControl:!1,streetViewControl:!0,singleInfoWindow:!0,html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",iconsize:[20,34],iconanchor:[9,34],infowindowanchor:[9,2],shadow:"http://www.google.com/mapfiles/shadow50.png",shadowsize:[37,34]},onComplete:function(){},travelMode:"BYCAR",travelUnit:"KM",routeDisplay:null,routeErrors:{INVALID_REQUEST:"The provided request is invalid.",NOT_FOUND:"One or more of the given addresses could not be found.",OVER_QUERY_LIMIT:"A temporary error occured. Please try again in a few minutes.",REQUEST_DENIED:"An error occured. Please contact us.",UNKNOWN_ERROR:"An unknown error occured. Please try again.",ZERO_RESULTS:"No route could be found within the given addresses."}}}(jQuery);