!function(o){var e=google.maps,n=new e.Geocoder,t=0,i={},i={init:function(n){var t,r=o.extend({},o.fn.gMap.defaults,n);for(t in o.fn.gMap.defaults.icon)r.icon[t]||(r.icon[t]=o.fn.gMap.defaults.icon[t]);return this.each(function(){var n=o(this),t=i._getMapCenter.apply(n,[r]);"fit"==r.zoom&&(r.zoom=i.autoZoom.apply(n,[r]));var a=new e.Map(this,{zoom:r.zoom,center:t,mapTypeControl:r.mapTypeControl,zoomControl:r.zoomControl,panControl:r.panControl,scaleControl:r.scaleControl,streetViewControl:r.streetViewControl,mapTypeId:r.maptype,scrollwheel:r.scrollwheel,maxZoom:r.maxZoom,minZoom:r.minZoom});if(r.log&&console.log("map center is:"),r.log&&console.log(t),n.data("$gmap",a),n.data("gmap",{opts:r,gmap:a,markers:[],markerKeys:{},infoWindow:null}),0!==r.controls.length)for(t=0;t<r.controls.length;t+=1)a.controls[r.controls[t].pos].push(r.controls[t].div);0!==r.markers.length&&i.addMarkers.apply(n,[r.markers]),i._onComplete.apply(n,[])})},_onComplete:function(){var o=this.data("gmap"),e=this;0!==t?window.setTimeout(function(){i._onComplete.apply(e,[])},1e3):o.opts.onComplete()},_setMapCenter:function(o){var e=this.data("gmap");if(e.opts.log&&console.log("delayed setMapCenter called"),void 0!==e.gmap)e.gmap.setCenter(o);else{var n=this;window.setTimeout(function(){i._setMapCenter.apply(n,[o])},500)}},_boundaries:null,_getBoundaries:function(o){if(i._boundaries)return i._boundaries;var e,n=o.markers[0].latitude,t=o.markers[0].longitude,r=o.markers[0].longitude,a=o.markers[0].latitude;for(e=1;e<o.markers.length;e+=1)n>o.markers[e].latitude&&(n=o.markers[e].latitude),t<o.markers[e].longitude&&(t=o.markers[e].longitude),r>o.markers[e].longitude&&(r=o.markers[e].longitude),a<o.markers[e].latitude&&(a=o.markers[e].latitude);return i._boundaries={N:n,E:t,W:r,S:a},i._boundaries},_getMapCenter:function(o){var t,r,a,s=this;if(o.markers.length&&("fit"==o.latitude||"fit"==o.longitude))return t=i._getBoundaries(o),t=new e.LatLng((t.N+t.S)/2,(t.E+t.W)/2);if(o.latitude&&o.longitude)return t=new e.LatLng(o.latitude,o.longitude);if(t=new e.LatLng(0,0),o.address)return n.geocode({address:o.address},function(e,n){n===google.maps.GeocoderStatus.OK?i._setMapCenter.apply(s,[e[0].geometry.location]):o.log&&console.log("Geocode was not successful for the following reason: "+n)}),t;if(o.markers.length>0){for(a=null,r=0;r<o.markers.length;r+=1)if(o.markers[r].setCenter){a=o.markers[r];break}if(null===a)for(r=0;r<o.markers.length;r+=1){if(o.markers[r].latitude&&o.markers[r].longitude){a=o.markers[r];break}o.markers[r].address&&(a=o.markers[r])}if(null===a)return t;if(a.latitude&&a.longitude)return new e.LatLng(a.latitude,a.longitude);a.address&&n.geocode({address:a.address},function(e,n){n===google.maps.GeocoderStatus.OK?i._setMapCenter.apply(s,[e[0].geometry.location]):o.log&&console.log("Geocode was not successful for the following reason: "+n)})}return t},setZoom:function(e){var n=this.data("gmap").gmap;"fit"===e&&(e=i.autoZoom.apply(o(this),[])),n.setZoom(parseInt(e))},getRoute:function(n){var t=this.data("gmap"),i=t.gmap,r=new e.DirectionsRenderer,a=new e.DirectionsService,s={BYCAR:e.DirectionsTravelMode.DRIVING,BYBICYCLE:e.DirectionsTravelMode.BICYCLING,BYFOOT:e.DirectionsTravelMode.WALKING},l={MILES:e.DirectionsUnitSystem.IMPERIAL,KM:e.DirectionsUnitSystem.METRIC},c=null,d=null,p=null;return void 0!==n.routeDisplay?c=n.routeDisplay instanceof jQuery?n.routeDisplay[0]:"string"==typeof n.routeDisplay?o(n.routeDisplay)[0]:null:null!==t.opts.routeDisplay&&(c=t.opts.routeDisplay instanceof jQuery?t.opts.routeDisplay[0]:"string"==typeof t.opts.routeDisplay?o(t.opts.routeDisplay)[0]:null),r.setMap(i),null!==c&&r.setPanel(c),d=void 0!==s[t.opts.travelMode]?s[t.opts.travelMode]:s.BYCAR,p=void 0!==l[t.opts.travelUnit]?l[t.opts.travelUnit]:l.KM,a.route({origin:n.from,destination:n.to,travelMode:d,unitSystem:p},function(n,i){i==e.DirectionsStatus.OK?r.setDirections(n):null!==c&&o(c).html(t.opts.routeErrors[i])}),this},processMarker:function(o,n,t,i){var r,a=this.data("gmap"),s=a.gmap,l=a.opts;if(void 0===i&&(i=new e.LatLng(o.latitude,o.longitude)),!n)var c={image:l.icon.image,iconSize:new e.Size(l.icon.iconsize[0],l.icon.iconsize[1]),iconAnchor:new e.Point(l.icon.iconanchor[0],l.icon.iconanchor[1]),infoWindowAnchor:new e.Size(l.icon.infowindowanchor[0],l.icon.infowindowanchor[1])},n=new e.MarkerImage(c.image,c.iconSize,null,c.iconAnchor);t||(new e.Size(l.icon.shadowsize[0],l.icon.shadowsize[1]),c&&c.iconAnchor||new e.Point(l.icon.iconanchor[0],l.icon.iconanchor[1])),r=new e.Marker({position:i,icon:n,title:o.title,map:s}),r.setShadow(t),a.markers.push(r),o.key&&(a.markerKeys[o.key]=r);var d;o.html&&(n={content:"string"==typeof o.html?l.html_prepend+o.html+l.html_append:o.html,pixelOffset:o.infoWindowAnchor},l.log&&console.log("setup popup with data"),l.log&&console.log(n),d=new e.InfoWindow(n),e.event.addListener(r,"click",function(){l.log&&console.log("opening popup "+o.html),l.singleInfoWindow&&a.infoWindow&&a.infoWindow.close(),d.open(s,r),a.infoWindow=d})),o.html&&o.popup&&(l.log&&console.log("opening popup "+o.html),d.open(s,r),a.infoWindow=d)},_geocodeMarker:function(o,r,a){t+=1;var s=this;n.geocode({address:o.address},function(n,l){t-=1,l===e.GeocoderStatus.OK?(s.data("gmap").opts.log&&console.log("Geocode was successful with point: ",n[0].geometry.location),i.processMarker.apply(s,[o,r,a,n[0].geometry.location])):s.data("gmap").opts.log&&console.log("Geocode was not successful for the following reason: "+l)})},autoZoom:function(o){var e,n=this.data("gmap"),t=39135.758482,o=n?n.opts:o;for(o.log&&console.log("autozooming map"),n=i._getBoundaries(o),o=111e3*(n.E-n.W)/this.width(),e=111e3*(n.S-n.N)/this.height(),n=2;20>n&&!(o>t||e>t);n+=1)t/=2;return n-2},addMarkers:function(e){var n=this.data("gmap").opts;if(0!==e.length)for(n.log&&console.log("adding "+e.length+" markers"),n=0;n<e.length;n+=1)i.addMarker.apply(o(this),[e[n]]);return this},addMarker:function(o){var n=this.data("gmap").opts;n.log&&console.log("putting marker at "+o.latitude+", "+o.longitude+" with address "+o.address+" and html "+o.html);var t=n.icon.image,r=new e.Size(n.icon.iconsize[0],n.icon.iconsize[1]),a=new e.Point(n.icon.iconanchor[0],n.icon.iconanchor[1]),s=new e.Size(n.icon.infowindowanchor[0],n.icon.infowindowanchor[1]),l=n.icon.shadow,c=new e.Size(n.icon.shadowsize[0],n.icon.shadowsize[1]),d=a;return o.infoWindowAnchor=s,o.icon&&(o.icon.image&&(t=o.icon.image),o.icon.iconsize&&(r=new e.Size(o.icon.iconsize[0],o.icon.iconsize[1])),o.icon.iconanchor&&(a=new e.Point(o.icon.iconanchor[0],o.icon.iconanchor[1])),o.icon.infowindowanchor&&new e.Size(o.icon.infowindowanchor[0],o.icon.infowindowanchor[1]),o.icon.shadow&&(l=o.icon.shadow),o.icon.shadowsize&&(c=new e.Size(o.icon.shadowsize[0],o.icon.shadowsize[1]))),t=new e.MarkerImage(t,r,null,a),l=new e.MarkerImage(l,c,null,d),o.address?("_address"===o.html&&(o.html=o.address),"_address"==o.title&&(o.title=o.address),n.log&&console.log("geocoding marker: "+o.address),i._geocodeMarker.apply(this,[o,t,l])):("_latlng"===o.html&&(o.html=o.latitude+", "+o.longitude),"_latlng"==o.title&&(o.title=o.latitude+", "+o.longitude),n=new e.LatLng(o.latitude,o.longitude),i.processMarker.apply(this,[o,t,l,n])),this},removeAllMarkers:function(){var o,e=this.data("gmap").markers;for(o=0;o<e.length;o+=1)e[o].setMap(null),delete e[o];e.length=0},getMarker:function(o){return this.data("gmap").markerKeys[o]}};o.fn.gMap=function(e){return i[e]?i[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void o.error("Method "+e+" does not exist on jQuery.gmap"):i.init.apply(this,arguments)},o.fn.gMap.defaults={log:!1,address:"",latitude:null,longitude:null,zoom:3,maxZoom:null,minZoom:null,markers:[],controls:{},scrollwheel:!0,maptype:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,zoomControl:!0,panControl:!1,scaleControl:!1,streetViewControl:!0,singleInfoWindow:!0,html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",iconsize:[20,34],iconanchor:[9,34],infowindowanchor:[9,2],shadow:"http://www.google.com/mapfiles/shadow50.png",shadowsize:[37,34]},onComplete:function(){},travelMode:"BYCAR",travelUnit:"KM",routeDisplay:null,routeErrors:{INVALID_REQUEST:"The provided request is invalid.",NOT_FOUND:"One or more of the given addresses could not be found.",OVER_QUERY_LIMIT:"A temporary error occured. Please try again in a few minutes.",REQUEST_DENIED:"An error occured. Please contact us.",UNKNOWN_ERROR:"An unknown error occured. Please try again.",ZERO_RESULTS:"No route could be found within the given addresses."}}}(jQuery);