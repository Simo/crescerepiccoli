!function(e){var t=0,i=function(){return(new Date).getTime()+t++},n=function(e){return"["+e+"]$1"},o=function(e){return"_"+e+"_$1"};e(document).on("click",".add_fields",function(t){t.preventDefault();var r=e(this),s=r.data("association"),a=r.data("associations"),l=r.data("association-insertion-template"),c=r.data("association-insertion-method")||r.data("association-insertion-position")||"before",u=r.data("association-insertion-node"),d=r.data("association-insertion-traversal"),h=parseInt(r.data("count"),10),f=new RegExp("\\[new_"+s+"\\](.*?\\s)","g"),p=new RegExp("_new_"+s+"_(\\w*)","g"),g=i(),m=l.replace(f,n(g)),v=[];for(m==l&&(f=new RegExp("\\[new_"+a+"\\](.*?\\s)","g"),p=new RegExp("_new_"+a+"_(\\w*)","g"),m=l.replace(f,n(g))),m=m.replace(p,o(g)),v=[m],h=isNaN(h)?1:Math.max(h,1),h-=1;h;)g=i(),m=l.replace(f,n(g)),m=m.replace(p,o(g)),v.push(m),h-=1;u=u?d?r[d](u):"this"==u?r:e(u):r.parent(),e.each(v,function(t,i){var n=e(i);u.trigger("cocoon:before-insert",[n]);u[c](n);u.trigger("cocoon:after-insert",[n])})}),e(document).on("click",".remove_fields.dynamic, .remove_fields.existing",function(t){var i=e(this),n=i.data("wrapper-class")||"nested-fields",o=i.closest("."+n),r=o.parent();t.preventDefault(),r.trigger("cocoon:before-remove",[o]);var s=r.data("remove-timeout")||0;setTimeout(function(){i.hasClass("dynamic")?o.remove():(i.prev("input[type=hidden]").val("1"),o.hide()),r.trigger("cocoon:after-remove",[o])},s)}),e(".remove_fields.existing.destroyed").each(function(t,i){var n=e(this),o=n.data("wrapper-class")||"nested-fields";n.closest("."+o).hide()})}(jQuery);